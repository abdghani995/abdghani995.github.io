<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>SYSTEM DESIGN NOTES</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
}

.simple-table-header {
	background: rgb(247, 246, 243);
	color: black;
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(145, 145, 142, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(187, 132, 108, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(215, 129, 58, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 148, 51, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(108, 155, 125, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(91, 151, 189, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(167, 130, 195, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(205, 116, 159, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(225, 111, 100, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(145, 145, 142, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(187, 132, 108, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(215, 129, 58, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 148, 51, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(108, 155, 125, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(91, 151, 189, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(167, 130, 195, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(205, 116, 159, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(225, 111, 100, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="e730032a-ad68-4b5d-ad0e-3cf98d83f513" class="page sans"><header><img class="page-cover-image" src="SYSTEM%20DESIGN%20NOTES%200e5ba93dcf32447494c8e8ed3e53e52a/sys.png" style="object-position:center 50%"/><div class="page-header-icon page-header-icon-with-cover"><img class="icon" src="SYSTEM%20DESIGN%20NOTES%200e5ba93dcf32447494c8e8ed3e53e52a/sysicon.jpeg"/></div><h1 class="page-title">SYSTEM DESIGN NOTES</h1></header><div class="page-body"><p id="68bd490c-30fd-4b1f-bfaa-3fa4cf6e6d4f" class="">Architecture is the shape of the software system. Thinking it as a big picture of physical buildings. Paradigms are bricks, design principles are rooms, components are buildings.</p><p id="5279ab5e-c113-4f8a-89af-159212dfaf6f" class=""><strong>TYPES OF ARCHITECTURE</strong></p><ul id="2dd52990-f20d-4fd8-8527-6f4ecb09cf0c" class="bulleted-list"><li style="list-style-type:disc"><strong>Layered Architecture</strong><ul id="d8bd75cf-cb03-4045-b732-5849c8dfb377" class="bulleted-list"><li style="list-style-type:circle">Most common architecture → Application layer &gt; Transport layer &gt; Internet Layer &gt; Network Access layer. </li></ul><ul id="6c2bc73e-1a16-4a4d-83c5-389e92d2c804" class="bulleted-list"><li style="list-style-type:circle"><strong>Monolitihic, </strong> hard to adjust, extend or update</li></ul></li></ul><ul id="f9cfa054-c819-4a5c-b531-94e49d99bd2b" class="bulleted-list"><li style="list-style-type:disc"><strong>Event Driven Architecture</strong><ul id="f6d1bf74-7900-49bf-92d1-41f71fe0fc7e" class="bulleted-list"><li style="list-style-type:circle">All connected system communicate through events. </li></ul><ul id="0166db12-1607-4352-9091-4f74aeae1b9b" class="bulleted-list"><li style="list-style-type:circle">Contains mediator, event queue, channel</li></ul></li></ul><ul id="820d2f44-eb53-45d2-9dd1-5acb85eb70b2" class="bulleted-list"><li style="list-style-type:disc"><strong>Micro-kernel Architecture (aka Plug-in Architecture)</strong><ul id="06506e14-7954-456e-b7d0-a9a27e1ad168" class="bulleted-list"><li style="list-style-type:circle">Plug and play softwares like VS code, Eclipse</li></ul></li></ul><ul id="84280e1d-87ba-4283-9824-0fb95a323193" class="bulleted-list"><li style="list-style-type:disc"><strong>Microservices Architecture</strong><ul id="dffd02c9-aed5-4cbb-86f0-430aa2277bb8" class="bulleted-list"><li style="list-style-type:circle">A huge decoupled system , with lots of small services separately deployed yet connected, generally through RPC</li></ul><ul id="7eff90b0-6e16-4841-8901-5a3aadcfbc12" class="bulleted-list"><li style="list-style-type:circle">Hard to maintain</li></ul></li></ul><h2 id="3d348bc6-1e40-4d40-b0f1-12dac3c5fb5c" class="">→ Basics</h2><ul id="1256f41e-a0f5-4576-92ea-92ac98d77f02" class="bulleted-list"><li style="list-style-type:disc"><strong>Scalable →</strong>means increased performance in proportion when more resources are added. If you have a <strong>scalability</strong> problem, your system is fast for a single user but slow under heavy load.</li></ul><ul id="b928f453-447c-4498-88f5-5e485ffbe646" class="bulleted-list"><li style="list-style-type:disc"><strong>Performance → </strong>means serving more units of work as the system grows. If you have a <strong>performance</strong> problem, your system is slow for a single user.</li></ul><ul id="960aae69-26b6-41cd-b5bf-71ffde9b4306" class="bulleted-list"><li style="list-style-type:disc"><strong>Why is scalability so hard</strong>?  Because scalability cannot be an after-thought. It requires applications and platforms to be designed with scaling in mind, such that adding resources actually results in improving the performance or that if redundancy is introduced the system performance is not adversely affected. </li></ul><ul id="d4226a02-56b4-49c5-9981-c509d04cc62b" class="bulleted-list"><li style="list-style-type:disc"><strong>Latency</strong> is the time to perform some action or to produce some result. <strong>Throughput</strong> is the number of such actions or results per unit of time. Generally, you should aim for <strong>maximal throughput</strong> with <strong>acceptable latency</strong>.<p id="61205fa6-e4b2-45f7-bbea-e29a24ede051" class="">
</p><p id="112e319d-55b0-4068-a028-0f66446aaa67" class=""><strong>HOW TO SCALE (Rough Idea)</strong></p><ul id="d4690b54-2331-40ce-8c39-94a0728292dc" class="bulleted-list"><li style="list-style-type:circle"><strong>Cloning X-axis ⇒</strong> having replicas of stateless instances behind a load balancer</li></ul><ul id="4106ec87-0bac-4295-8a0a-8f49c55b134e" class="bulleted-list"><li style="list-style-type:circle"><strong>Segmentation ⇒ </strong>Separating out into individual services and scaling out each as per need</li></ul><ul id="4e42857c-9193-481c-8161-322f5c90b1c8" class="bulleted-list"><li style="list-style-type:circle"><strong>Sharding ⇒ </strong>Replicating the entire stack, and each <strong>pod</strong> can target a specific large group of users, based on geography.</li></ul></li></ul><p id="2152f946-437c-46eb-8633-4df41314a3ad" class="">
</p><h2 id="972b112f-7530-4728-8a73-7d1555f6cc1c" class="">→ CAP theorem</h2><p id="b078bd04-4d3c-48e9-91e0-5d55ba4392f2" class="">The CAP Theorem states that, in a distributed system (a collection of interconnected nodes that share data.), you can only have two out of the following three guarantees across a write/read pair: Consistency, Availability, and Partition Tolerance - one of them must be sacrificed. However, as you will see below, you don&#x27;t have as many options here as you might think.</p><p id="876b0bf1-5c83-4d26-a0ff-ec4cab6655e4" class="">
</p><p id="e25c8d76-65fd-4bdd-ade5-3047a43fb704" class="">Consider a system with 2 ATM and a central server, In a distributed system u can either ensure that  all the ATMS are always available or all of them are consistent. </p><figure id="0e5ba93d-cf32-4474-94c8-e8ed3e53e52a" class="image"><a href="SYSTEM%20DESIGN%20NOTES%200e5ba93dcf32447494c8e8ed3e53e52a/CAP-overview.png"><img style="width:500px" src="SYSTEM%20DESIGN%20NOTES%200e5ba93dcf32447494c8e8ed3e53e52a/CAP-overview.png"/></a></figure><ul id="fed27e0d-8a56-4cd1-ba63-b97702a85ba7" class="bulleted-list"><li style="list-style-type:disc"><strong>Consistency</strong> - A read is guaranteed to return the most recent write for a given client. or an error.<ul id="a6575686-dfbf-417f-bc84-e8b839c99fca" class="bulleted-list"><li style="list-style-type:circle"><strong>Weak Consistency → </strong>After a write , next read may or may not see it . Best approach is taken → used in <strong>memcached</strong> or in VoIP, after the transmission failure you do not hear what was said during connection loss</li></ul><ul id="9b2b33c8-c5a9-40e3-bef9-25ef8f38e438" class="bulleted-list"><li style="list-style-type:circle"><strong>Eventual Consistency → </strong> After a write , read will eventually see it, Data is replicated asynchronously, This approach is seen in systems such as DNS and email. Works well in system with high availability</li></ul><ul id="1799ddbf-c05a-4f65-a020-cdf25cc347c1" class="bulleted-list"><li style="list-style-type:circle"><strong>Strong Consistency → </strong>After a write, read must see it, Data is replicated synchronously. Mainly seen in RDBMS or where ever transaction is involved</li></ul></li></ul><ul id="ead0be1f-f420-43b1-bbb1-b4e4aa4a7f1e" class="bulleted-list"><li style="list-style-type:disc"><strong>Availability</strong> - A non-failing node will return a reasonable response within a reasonable amount of time (no error or timeout).<ul id="3cb20ccd-1678-4293-9794-ba20671536f4" class="bulleted-list"><li style="list-style-type:circle"><strong>Cold Standby</strong>: Use heartbeat or metrics/alerts to track failure. Provision new standby nodes when a failure occurs. Only suitable for stateless services.</li></ul><ul id="d3175d03-c121-4c90-ad9b-3e7fbf7cb6a7" class="bulleted-list"><li style="list-style-type:circle"><strong>Hot Standby</strong>: Keep two active systems undertaking the same role. Data is mirrored in near real time, and both systems will have identical data.</li></ul><ul id="c20c1972-e004-4b5b-85d9-5c52c369fb80" class="bulleted-list"><li style="list-style-type:circle"><strong>Warm Standby</strong>: Keep two active systems but the secondary one does not take traffic unless the failure occurs.</li></ul><ul id="57203dbc-88da-46dd-87bf-1cbc69536499" class="bulleted-list"><li style="list-style-type:circle">Availability is often quantified by uptime (or downtime) as a percentage of time the service is available. Availability is generally measured in number of 9s--a service with 99.99% availability is described as having four 9s.</li></ul><ul id="99413222-f023-4919-a99b-f755de7951bb" class="bulleted-list"><li style="list-style-type:circle">If a service consists of multiple components prone to failure, the service&#x27;s overall availability depends on whether the components are in sequence or in parallel.</li></ul><ul id="7a90eac5-6081-4668-bb4c-967978c31d0b" class="bulleted-list"><li style="list-style-type:circle">Overall availability decreases when two components with availability &lt; 100% are in sequence than in parallel<ul id="c1cdc9d6-a1de-47d0-bf04-72944900ba1e" class="bulleted-list"><li style="list-style-type:square"><code>Availability (Total) = Availability (Foo) * Availability (Bar)</code> 99.9% + 99.9% ⇒ 99.8</li></ul><ul id="ab37db5f-f9f4-46e4-abd4-8905738ffb88" class="bulleted-list"><li style="list-style-type:square"><code>Availability (Total) = 1 - (1 - Availability (Foo)) * (1 - Availability (Bar))</code> 99.9% + 99.9% ⇒ 99.9</li></ul></li></ul></li></ul><ul id="632a0c26-d0c2-419e-a9e0-85ee8d2442d2" class="bulleted-list"><li style="list-style-type:disc"><strong>Partition Tolerance</strong> - The system will continue to function when network partitions occur.</li></ul><p id="d66c623a-dffc-4813-a3be-83f3c110a101" class="">
</p><p id="c95872e5-41c0-4bd9-b83a-d598afe43673" class="">A distributed system is bound to be partitioned so we are left with two options → consistent or available. <div class="indented"><ul id="0b60da7a-4208-449d-9cec-84828bbdcfae" class="bulleted-list"><li style="list-style-type:disc"><strong>CP → </strong>The system may timeout or return error after timeout. <ul id="2a4e4fbe-0cb8-44c7-8d05-b9d196dc9e0b" class="bulleted-list"><li style="list-style-type:circle">Choose <strong>Consistency </strong>over <strong>Availability </strong> when your business requirements dictate atomic read and writes </li></ul></li></ul><ul id="b9bf4804-a971-4af5-bfc6-3ca7d05cbea1" class="bulleted-list"><li style="list-style-type:disc"><strong>AP → </strong>Returns the most recent version of the data ,that can be stale.<ul id="cf29f284-05d4-407a-852a-7651eec814f4" class="bulleted-list"><li style="list-style-type:circle">Choose <strong>Availability</strong> over <strong>Consistency </strong>when your business requirements allows reluctancy on the accuracy of data, but must always be available</li></ul><ul id="c55d70b9-fd5a-4b6e-9d7d-f5f6726eff85" class="bulleted-list"><li style="list-style-type:circle">Also helpful when the system continues to work even after some internal failure</li></ul><ul id="fc317325-8d29-42f7-870a-42200b39e8a6" class="bulleted-list"><li style="list-style-type:circle">AP is a good choice if the business needs allow for <a href="https://github.com/donnemartin/system-design-primer#eventual-consistency">eventual consistency</a> or when the system needs to continue working despite external errors.</li></ul></li></ul></div></p><p id="641b7107-00e2-4909-8c1d-c950622b9a31" class=""><strong>EXTRAS</strong></p><ul id="6238b226-e362-4d08-a877-8304aec568de" class="bulleted-list"><li style="list-style-type:disc">12 years later, the author Eric Brewer said “2 of 3” is mis-leading, because → partitions are rare, and there is no reason to loose C or A</li></ul><ul id="6e237803-2120-4a78-ab79-2dc129f4ec70" class="bulleted-list"><li style="list-style-type:disc">Consequently, when there is no partition (nodes are connected correctly), which is often the case, we should have both AC. When there are partitions, deal them with 3 steps:<ul id="6691cdf7-2e31-4b09-8324-d747ad01bc1d" class="bulleted-list"><li style="list-style-type:circle">detect the start of a partition,</li></ul><ul id="152a2d0a-88ad-4215-b2aa-527733f82813" class="bulleted-list"><li style="list-style-type:circle">enter an explicit partition mode that may limit some operations, and</li></ul><ul id="95653c56-a0d4-45b3-bcea-6afe36d9ee5b" class="bulleted-list"><li style="list-style-type:circle">initiate partition recovery (compensate for mistakes) when communication is restored.</li></ul></li></ul><h2 id="eddef4ca-e9af-4cf7-90df-1a5e904af9c4" class="">→ DNS</h2><p id="736d720b-f343-4730-8788-1d437f41d907" class="">DNS is hierarchical → </p><ul id="71fe08f0-3ef1-4252-9467-7b4625d13ecc" class="bulleted-list"><li style="list-style-type:disc">Your router or ISP provides information about which DNS server(s) to contact when doing a lookup. Lower level DNS servers cache mappings, which could become stale due to DNS propagation delays.DNS results can also be cached by your browser or OS for a certain period of time, determined by the <a href="https://en.wikipedia.org/wiki/Time_to_live">time to live (TTL)</a>.</li></ul><ul id="a5092919-a898-4561-a58e-5cb7b0f1ea17" class="bulleted-list"><li style="list-style-type:disc"><strong>Time to live</strong> (<strong>TTL</strong>) or <strong>hop limit</strong> is a mechanism which limits the lifespan or lifetime of data in a computer or network. TTL may be implemented as a <a href="https://en.wikipedia.org/wiki/Counter_(digital)">counter</a> or <a href="https://en.wikipedia.org/wiki/Timestamp">timestamp</a> attached to or embedded in the data.</li></ul><p id="7f3b5efe-da46-4e2a-88ad-52d56623b5e7" class=""><strong>COMPONENTS</strong></p><ul id="e8cdd84f-8309-496f-8529-ba18c367c723" class="bulleted-list"><li style="list-style-type:disc"><strong>NS record (name server)</strong> - Specifies the DNS servers for your domain/subdomain.</li></ul><ul id="4ee6824b-9451-4572-b0e3-8ec5b639b27d" class="bulleted-list"><li style="list-style-type:disc"><strong>MX record (mail exchange)</strong> - Specifies the mail servers for accepting messages.</li></ul><ul id="9456f14d-f02e-4a56-8734-4197c67282b0" class="bulleted-list"><li style="list-style-type:disc"><strong>A record (address)</strong> - Points a name to an IP address.</li></ul><ul id="782c5035-a514-4cdf-a2f0-0df196f47db1" class="bulleted-list"><li style="list-style-type:disc"><strong>CNAME (canonical)</strong> - Points a name to another name or <code>CNAME</code> (example.com to <a href="http://www.example.com/">www.example.com</a>) or to an <code>A</code> record.</li></ul><p id="a0a93771-56c0-4806-9b86-988b2a56a99b" class=""><strong>ROUTING</strong></p><ul id="4736eca1-13fc-45b1-a3ea-ad03c2873879" class="bulleted-list"><li style="list-style-type:disc"><a href="https://www.g33kinfo.com/info/round-robin-vs-weighted-round-robin-lb">Weighted round robin</a><ul id="f2f021b5-bab1-4ce0-9dec-f53645eb2a6b" class="bulleted-list"><li style="list-style-type:circle">Prevent traffic from going to servers under maintenance</li></ul><ul id="4d6fc7c0-d64e-4f5f-9e43-bee5aa89c60e" class="bulleted-list"><li style="list-style-type:circle">A/B testing</li></ul></li></ul><ul id="5edb3666-d61f-460c-baa4-5f77d763ef3f" class="bulleted-list"><li style="list-style-type:disc"><a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/routing-policy.html#routing-policy-latency">Latency-based</a></li></ul><ul id="75365c3b-d31d-48be-ae35-3bba18c30aa7" class="bulleted-list"><li style="list-style-type:disc"><a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/routing-policy.html#routing-policy-geo">Geolocation-based</a></li></ul><p id="dfe058b5-7b4a-4fec-9f2f-94c984472ef7" class=""><strong>DISADVANTAGE</strong></p><p id="208f35ab-676c-4cc3-89e5-2662d5863e6d" class="">Accessing DNS server can create delay, they are complicated and generally managed by governments, ISP’s and large companies. prone to DDOS attack.</p><p id="412c41b2-9abe-41b5-b24d-97252499eb74" class="">
</p><h2 id="6fc0fdc4-37d7-48b8-bddd-22746b0898dd" class="">→ <strong>CDN</strong></h2><p id="79b8fd5b-3fea-410f-a3fa-836b0358fcc6" class="">Globally distributed network of proxy servers, serving content from locations closer to the user, generally html, css, JS, photos and videos. CDN decreases latency by decreasing the round trip time. i.e. latency of requests by providing it from the nearest edge. Servers don’t need to serve requests that the CDN fulfils. <strong>Akamai (flash crowd problem) or AWS cloudfront.</strong></p><p id="5f8c6eb2-ebcd-472a-9030-69160943c6a1" class="">A pull CDN, the CDN caches parts of your site upon request to their servers. A push CDN is where you upload your entire website to the CDN so it’s ready for users at any given time. Let’s look a bit further.</p><p id="2f423787-84b1-4f35-9ae5-4a3303d496b3" class=""><strong>PUSH CDN</strong></p><p id="dfa0b7d7-d0d8-44fa-a85a-c73ac7cffafb" class="">Push CDNs receives new content whenever changes occur on your server. </p><ul id="ad60b32d-408f-47be-a740-65103a7d0de0" class="bulleted-list"><li style="list-style-type:disc">Developer is fully responsible for uploading updated content to CDN and rewrite URL’s to point to the CDN. </li></ul><ul id="6b8fb72c-c64b-49c3-9800-b42ab7c2e147" class="bulleted-list"><li style="list-style-type:disc">Developer has control over when the content expiry and replacements</li></ul><ul id="691e797d-0d60-40eb-99cc-37cc86193fb5" class="bulleted-list"><li style="list-style-type:disc">Works well with sites with lower traffic or sites which aren’t updated frequently</li></ul><ul id="6a792e36-8a48-4e2f-a94e-0bfc76b7a470" class="bulleted-list"><li style="list-style-type:disc">Push CDN maximises storage</li></ul><p id="b469d9d9-4c66-443c-b841-dbc1023a1eb4" class=""><strong>PULL CDN</strong></p><p id="b657a5a5-dcbf-40a8-8dfb-f9b481826ebf" class="">Pull CDNs grab new content from your server when the first user requests the content. </p><ul id="02037d3d-c274-466f-bb66-3580d2b5eb71" class="bulleted-list"><li style="list-style-type:disc">You leave the content on your server and rewrite URLs to point to the CDN. This results in a slower request until the content is cached on the CDN.</li></ul><ul id="8b504530-c60c-4f77-b0de-4928085a4eae" class="bulleted-list"><li style="list-style-type:disc"><strong>TTL </strong>decides how long the file is cached in CDN. It uses less storage but can create redundant traffic if file expires and are pulled before they have actually changed.</li></ul><ul id="b6d12c65-8a09-4a2c-8c74-3391a2bef81e" class="bulleted-list"><li style="list-style-type:disc">Works well with heavy traffic, as only recently requested content remains on the CDN</li></ul><p id="797065a3-b92f-404e-8d07-5ade8f7b1187" class=""><strong>DISADVANTAGES</strong></p><ul id="73080e1f-1cb9-446e-840d-b0931dc57bca" class="bulleted-list"><li style="list-style-type:disc">could be costly based on traffic</li></ul><ul id="e8b79596-9692-4340-b3d9-e17742865274" class="bulleted-list"><li style="list-style-type:disc">might be stale if it is updated before TTL expires</li></ul><ul id="d075fd55-badf-406f-ab8a-c770439f7b57" class="bulleted-list"><li style="list-style-type:disc">would require changing url of <strong>static content </strong> to point to the CDN</li></ul><p id="73671254-e308-4acd-8ec0-aec0f09f8e8c" class="">
</p><h2 id="13b90f04-e4c3-4db7-9ab9-2644ebe8465f" class="">→ LOAD BALANCER</h2><p id="9eb1bced-9f0b-498b-a442-7b71f49020e7" class="">
</p><figure id="a858acc5-093a-41eb-81db-603ff6595d9f" class="image"><a href="SYSTEM%20DESIGN%20NOTES%200e5ba93dcf32447494c8e8ed3e53e52a/loadbalancer.png"><img style="width:1019px" src="SYSTEM%20DESIGN%20NOTES%200e5ba93dcf32447494c8e8ed3e53e52a/loadbalancer.png"/></a></figure><p id="a2907a20-c504-4985-a7c2-e232492fa525" class="">Load balancers <strong>distribute incoming client requests to computing resources</strong> such as application servers and databases. In each case, the load balancer returns the response from the computing resource to the appropriate client. </p><ul id="56de97a2-818a-4d52-95b1-659f4184bded" class="bulleted-list"><li style="list-style-type:disc">Prevents one server from getting overloaded, by balancing them between servers</li></ul><ul id="6bfb52d9-e5fe-4e5c-98c0-55711e656f0a" class="bulleted-list"><li style="list-style-type:disc">Eliminates single point of failure</li></ul><ul id="cc389cc3-a807-44d8-b362-b0d850ed4993" class="bulleted-list"><li style="list-style-type:disc">Implemented using HAProxy or Nginx</li></ul><ul id="e2467d6b-02e7-4038-af04-6b7dc7dfb0cc" class="bulleted-list"><li style="list-style-type:disc">Can be used as a termination point of SSL, therby removing the need to install <a href="https://en.wikipedia.org/wiki/X.509">X.509 certificates</a> on each server</li></ul><ul id="525952ec-d919-457a-bc2a-90acb6a0d74c" class="bulleted-list"><li style="list-style-type:disc">Using sticky session to route requests to the same server</li></ul><p id="22582db0-b3da-46d2-b926-2b7f16a7a185" class=""><strong>Routing Algos </strong></p><ul id="32d22440-2baf-4dc5-bd09-c8b51c5c8293" class="bulleted-list"><li style="list-style-type:disc"><strong>Least Connection Method</strong> → This method directs traffic to the server with the fewest active connections. This approach is quite useful when there are a large number of persistent client connections which are unevenly distributed between the servers.</li></ul><ul id="1669b22f-84cf-4e15-9b2f-91ae7eea1842" class="bulleted-list"><li style="list-style-type:disc"><strong>Least Response Time Method</strong> — This algorithm directs traffic to the server with the fewest active connections and the lowest average response time.</li></ul><ul id="1688a407-1727-45b5-a748-17c3e0f498c3" class="bulleted-list"><li style="list-style-type:disc"><strong>Least Bandwidth Method</strong> - This method selects the server that is currently serving the least amount of traffic measured in megabits per second (Mbps).</li></ul><ul id="85273280-2a90-4d50-aed1-2b6d2b63930e" class="bulleted-list"><li style="list-style-type:disc"><strong>Round Robin Method</strong> — This method cycles through a list of servers and sends each new request to the next server. When it reaches the end of the list, it starts over at the beginning. It is most useful when the servers are of equal specification and there are not many persistent connections.</li></ul><ul id="033c8eeb-6982-4e66-99c0-d0bb22d0bc72" class="bulleted-list"><li style="list-style-type:disc"><strong>Weighted Round Robin Method</strong> — The weighted round-robin scheduling is designed to better handle servers with different processing capacities. Each server is assigned a weight (an integer value that indicates the processing capacity). Servers with higher weights receive new connections before those with less weights and servers with higher weights get more connections than those with less weights.</li></ul><ul id="5ddcac03-34cf-4751-9810-a58346ef4848" class="bulleted-list"><li style="list-style-type:disc"><strong>IP Hash</strong> — Under this method, a hash of the IP address of the client is calculated to redirect the request to a server.</li></ul><p id="82c46de6-522a-41d9-b1e9-a991818dc261" class="">The load balancer can be a single point of failure; to overcome this, a second load balancer can be connected to the first to form a cluster. Each LB monitors the health of the other and, since both of them are equally capable of serving traffic and failure detection, in the event the main load balancer fails, the second load balancer takes over.</p><p id="a9efc23c-6d6c-4d9d-8ceb-949129e3f6d1" class="">
</p><p id="888e0f38-6a55-4c58-9f45-f7dfadf7bf5f" class=""><strong>Load Balancing and SSL</strong></p><p id="0c9a7b2a-3be1-4fc1-9cfd-cdf4de7f33fa" class=""><a href="https://blog.stackpath.com/ssl/">SSL</a> traffic is often decrypted at the load balancer. When a load balancer decrypts traffic before passing the request on, it is called SSL termination.The load balancer saves the web servers from having to expend the extra CPU cycles required for decryption. This improves application performance. However, <a href="https://www.notion.so/SSL-ee156d559b424c979d201329c753f5e2">SSL termination</a> comes with a security concern. The traffic between the load balancers and the web servers is no longer encrypted. This can expose the application to possible attack. However, the risk is lessened when the load balancer is within the same data center as the web servers.</p><p id="bfa311d2-31dd-40c6-90e4-42efcc50fda5" class="">Another solution is the <a href="https://www.notion.so/SSL-ee156d559b424c979d201329c753f5e2">SSL pass-through</a>. The load balancer merely passes an encrypted request to the web server. Then the web server does the decryption. This uses more CPU power on the web server. But organizations that require extra security may find the extra overhead worthwhile.</p><p id="3c5dd17c-9917-4f62-bb00-7c1574c421dd" class="">
</p><p id="6eb522a7-038e-4b3c-81f0-5034f31bc2f8" class=""><strong>Load Balancing and Security</strong></p><p id="4c237e58-9bac-46c9-a6a5-b1de9faaf094" class="">Load Balancing plays an important security role as computing moves evermore to the cloud. The off-loading function of a load balancer defends an organization against distributed denial-of-service (DDoS) attacks. It does this by shifting attack traffic from the corporate server to a public cloud provider. DDoS attacks represent a large portion of cybercrime as their number and size continues to rise. Hardware defense, such as a perimeter firewall, can be costly and require significant maintenance. Software load balancers with cloud offload provide efficient and cost-effective protection.</p><p id="4be4918e-0fb8-4a4e-8c67-22945be7967d" class="">A <strong>perimeter firewall</strong> refers to a security application that defends the boundary between a private network and a public network. Its goal is to prevent unwanted or suspicious data from entering the network. It protects against cyberattacks and other malicious traffic by scanning each data packet that tries to enter the network.</p><p id="5b197b52-3b50-4676-bc09-8d19346c7082" class="">A perimeter firewall can also act as a proxy service, an intermediary between users and the internet, that allows greater access control by an administrator. As a perimeter firewall examines the content of the data packet, it can tell if it contains a threat based on the information in the packet’s header and the payload of the packet itself.</p><p id="0640042b-a492-41e1-b766-b4ec0461a2ad" class="">
</p><p id="994f2ba4-e86f-4a89-b259-41ebb7c0bc52" class=""><strong>Capabilities</strong></p><p id="b8e74939-665e-4292-baa9-1e29995a3280" class="">LB happens between layers four to seven (L4-Transport, L5-Session, L6-Presentation and L7-Application). Load balancers have different capabilities, which include:</p><ul id="2d8b38d4-888c-4129-a292-576aa6cb8dff" class="bulleted-list"><li style="list-style-type:disc">L4 — directs traffic based on data from network and transport layer protocols, such as IP address and TCP port.</li></ul><ul id="d5fe0faf-22c7-4792-bad1-a187892e7ea1" class="bulleted-list"><li style="list-style-type:disc">L7 — adds content switching to load balancing. This allows routing decisions based on attributes like HTTP header, uniform resource identifier, SSL session ID and HTML form data.</li></ul><ul id="2bd71d50-76d9-4538-a714-7176749f1db2" class="bulleted-list"><li style="list-style-type:disc">GSLB — <a href="https://www-stage.avinetworks.com/glossary/global-server-load-balancing-2/">Global Server Load Balancing</a> extends L4 and L7 capabilities to servers in different geographic locations.</li></ul><p id="842562f5-b0e3-4032-9058-bca1d3f3c3dd" class="">More enterprises are seeking to deploy cloud-native applications in data centers and public clouds. This is leading to significant changes in the capability of load balancers. In turn, this creates both challenges and opportunities for infrastructure and operations leaders.</p><p id="37c8ec6e-1cea-4886-bb2f-954e1e598c49" class="">
</p><p id="c00d77c0-93c8-496e-b2c6-a315f92fac52" class=""><strong>NGINX Load balancing</strong></p><pre id="16cfa13c-c0c7-44bf-b7d3-d43958c538b5" class="code code-wrap"><code>http {
    upstream myapp1 {
				(least_conn/ip_hash)
        server srv1.example.com (weight=3);
        server srv2.example.com;
        server srv3.example.com;
    }

    server {
        listen 80;

        location / {
            proxy_pass http://myapp1;
        }
    }
}</code></pre><p id="6d1515ee-3a63-4a87-9783-1137054d8c74" class="">
</p><p id="aaebb5fc-e0eb-4e21-bb00-24f8626a1a6c" class=""><strong>L4</strong></p><p id="0d214356-2011-4c82-88dd-6b9fc6ddb1da" class="">In L4 only <strong>IP</strong> and <strong>PORT</strong> are known and descides based on that by running an algorithm. <strong>Layer 4 load balancing</strong> uses information defined at the networking <em>transport</em> layer (ip and port) (Layer 4) as the basis for deciding how to distribute client requests across a group of servers<div class="indented"><ul id="52bfd22f-f196-44e0-bde9-31625c854362" class="block-color-teal_background bulleted-list"><li style="list-style-type:disc">Simple load balancing - Efficient - doesn&#x27;t look into the data</li></ul><ul id="0d6691c8-1ba6-4958-95d2-ec2cebb1b87c" class="block-color-teal_background bulleted-list"><li style="list-style-type:disc">More secure (subjective) as it doesnt decrypts the data (doesnt have the algo to decrypt). </li></ul><ul id="843134db-3871-457a-805b-677560353672" class="block-color-teal_background bulleted-list"><li style="list-style-type:disc">One TCP connection :- more efficient</li></ul><ul id="3041f0ef-a546-4820-99a6-e958a3f76001" class="block-color-teal_background bulleted-list"><li style="list-style-type:disc">uses NAT - it also performs Network Address Translation (NAT) on the request packet, changing the recorded destination IP address from its own to that of the content server it has chosen on the internal network. <strong>Statefullness</strong></li></ul><ul id="07d43562-288a-4a1c-8bb2-810a8433872e" class="block-color-red_background bulleted-list"><li style="list-style-type:disc">No smart load balancing <ul id="1ee03e5d-eeb8-4458-a84e-e174271e62f7" class="bulleted-list"><li style="list-style-type:circle">cant look into the data - so no smart way of routing</li></ul></li></ul><ul id="18f0e288-0011-4c06-88d3-ab15879f91e8" class="block-color-red_background bulleted-list"><li style="list-style-type:disc">Cant use microservices</li></ul><ul id="29d4ba2b-3cba-4645-b09f-886df4790c07" class="block-color-red_background bulleted-list"><li style="list-style-type:disc">No caching as u dont know if the data is important</li></ul><ul id="a17472a7-649b-4c9e-b9da-d567837e879f" class="block-color-red_background bulleted-list"><li style="list-style-type:disc">Sticky to server sometime</li></ul></div></p><p id="9bdc0dc2-9577-4ba3-b222-7ff302044ffe" class="">
</p><p id="498a485c-3509-4104-87ba-038e50edc755" class=""><strong>L7</strong></p><p id="2e5e1d2a-f868-4f2c-884b-ffe3c1546592" class="">Layer 7 load balancers base their routing decisions on various characteristics of the HTTP header and on the actual contents of the message, such as the URL, the type of data (text, video, graphics), or information in a cookie.<div class="indented"><ul id="542fbbd3-cee3-4af8-97bd-165adbff7179" class="bulleted-list"><li style="list-style-type:disc">Smart load balancing</li></ul><ul id="e8a8afd9-30f7-45bf-95dc-4ab047ea61ff" class="bulleted-list"><li style="list-style-type:disc">Caching</li></ul><ul id="6acf5e5c-e6e0-4b6a-8647-c7c0193ded96" class="bulleted-list"><li style="list-style-type:disc">Microservices</li></ul><ul id="04523d0a-3b3d-4d24-a1ac-78cc1dda5ad5" class="bulleted-list"><li style="list-style-type:disc">Expensive (compared to L4) as it looks into the data </li></ul><ul id="685b8297-c5b8-4aed-af8f-326330e09bfc" class="bulleted-list"><li style="list-style-type:disc">SSL termination happens here, so it can be less secure</li></ul></div></p><p id="12881875-f4ec-4676-9b90-ce4cb926c29d" class="">
</p><p id="53b63823-e189-4b3f-a136-b8bdee89cc3d" class="">Modern general-purpose load balancers, such as NGINX Plus and the open source NGINX software, generally operate at Layer 7 and serve as full <a href="https://www.nginx.com/resources/glossary/reverse-proxy-server">reverse proxies</a>. Rather than manage traffic on a packet-by-packet basis like Layer 4 load balancers that use NAT, Layer 7 load balancing proxies can read requests and responses in their entirety. They manage and manipulate traffic based on a full understanding of the transaction between the client and the application server.</p><p id="ce164be4-85b7-4709-8f94-989f4ac61578" class=""><strong>Some load balancers can be configured to provide Layer 4 or Layer 7 load balancing, depending on the nature of the service. As mentioned previously, modern commodity hardware is generally powerful enough that the savings in computational cost from Layer 4 load balancing are not large enough to outweigh the benefits of greater flexibility and efficiency from Layer 7 load balancing.</strong></p><p id="2f4cd904-409c-4927-aa07-efbc8810fe22" class="">
</p><h2 id="a733aa77-51c9-49c1-b40a-753e452cef17" class="">→ PROXY SERVER</h2><p id="56a73a3e-aedc-4653-a651-6dd93e3a45d0" class="">Generally a server that hides the identity of a system . Traffics are routed through a proxy server. A proxy server is a go‑between or intermediary server that forwards requests for content from multiple clients to different servers across the Internet. A forward proxy, often called a proxy, proxy server, or web proxy, is a server that sits in front of a group of client machines. When those computers make requests to sites and services on the Internet, the proxy server intercepts those requests and then communicates with web servers on behalf of those clients, like a middleman.<div class="indented"><ul id="38d915b9-2ca5-4380-ae8a-4da1b9a122e1" class="bulleted-list"><li style="list-style-type:disc">Anonimity</li></ul><ul id="70806d25-1534-4774-9b97-06cbd0a6a79b" class="bulleted-list"><li style="list-style-type:disc">Caching<ul id="02b9babf-5dcf-4895-aa9c-a048d2587e61" class="bulleted-list"><li style="list-style-type:circle">caching the most used contents</li></ul></li></ul><ul id="3317b603-83d6-4dd1-ac5f-664b866e7243" class="bulleted-list"><li style="list-style-type:disc">Blocking unwanted sites<ul id="c9366115-1f0d-4a68-9fb6-fda18a3f6170" class="bulleted-list"><li style="list-style-type:circle">Certain countries block political and adult content. they do so by blocking the proxy servers, serving those geological area.</li></ul></li></ul><ul id="c776a353-9eab-4db0-b68e-dcfd96d49a2c" class="bulleted-list"><li style="list-style-type:disc">GeoFecning<ul id="906132c6-4187-408e-ad41-b3d820a7e941" class="bulleted-list"><li style="list-style-type:circle">Geologically blocking content</li></ul></li></ul></div></p><ol type="1" id="dcdf63c6-b163-4c5b-a20f-8167f1470854" class="numbered-list" start="1"><li><strong>Anonymous Proxy</strong> - Thіs proxy reveаls іts іdentіty аs а server but does not dіsclose the іnіtіаl IP аddress. Though thіs proxy server cаn be dіscovered eаsіly іt cаn be benefіcіаl for some users аs іt hіdes their IP аddress. <strong>VPN</strong></li></ol><ol type="1" id="a63fca22-545f-4d39-8b86-06c7b4de0c35" class="numbered-list" start="2"><li><strong>Trаnspаrent Proxy</strong> – Thіs proxy server аgаіn іdentіfіes іtself, аnd wіth the support of HTTP heаders, the fіrst IP аddress cаn be vіewed. The mаіn benefіt of usіng thіs sort of server іs іts аbіlіty to cаche the websіtes.</li></ol><p id="6ded9b54-120c-4aa5-a948-6653ebd90bcb" class="">A <strong>VPN is similar to a proxy</strong>, but instead of working with single apps or websites, it works with every site you visit or app you access. Like a proxy, when you visit a website after first logging into a VPN, your IP address is hidden and replaced with the IP address of your VPN provider.</p><p id="bec55793-1486-4aee-9dfa-903f5dfee344" class="">
</p><h3 id="4fa95724-1ddc-4842-bee9-7e3d0e64e0cd" class="">Reverse Proxy server :- </h3><p id="ceea2386-5ea6-4421-b192-9cd2bd6f88da" class="">A <strong>reverse proxy server</strong> is a type of proxy server that typically sits behind the firewall in a private network and directs client requests to the appropriate backend server. A reverse proxy provides an additional level of abstraction and control to ensure the smooth flow of network traffic between clients and servers.</p><ul id="038fa248-194e-486a-8615-8d81e7a48efd" class="bulleted-list"><li style="list-style-type:disc"><strong>Load balancing</strong> – A reverse proxy server can act as a “traffic cop,” sitting in front of your backend servers and <strong>distributing client requests</strong> across a group of servers in a manner that maximises speed and capacity utilisation while ensuring no one server is overloaded, which can degrade performance. If a server goes down, the <a href="https://www.nginx.com/solutions/adc/">load balancer</a> redirects traffic to the remaining online servers.</li></ul><ul id="b69de1e6-a4cb-48f2-9698-2348c831da2c" class="bulleted-list"><li style="list-style-type:disc"><strong>Web acceleration</strong> – Reverse proxies can <strong>compress inbound and outbound data</strong>, as well as <strong>cache commonly requested content</strong>, both of which speed up the flow of traffic between clients and servers. They can also perform additional tasks such as <strong>SSL termination</strong> to take load off of your web servers, thereby <a href="https://www.nginx.com/resources/glossary/web-acceleration/">boosting their performance</a>.</li></ul><ul id="940d6333-9044-4d94-8812-26caaae337a2" class="bulleted-list"><li style="list-style-type:disc"><strong>Security and anonymity</strong> – By intercepting requests headed for your backend servers, a <strong>reverse proxy server protects their identities </strong>and acts as an additional defence against security attacks. It also ensures that multiple servers can be accessed from a single record locator or URL regardless of the structure of your local area network.</li></ul><ul id="d059e136-b391-4cf5-8db0-3152d05147f9" class="bulleted-list"><li style="list-style-type:disc"><strong>Ingress → </strong>Routing certain url to certain location, also helpful in managing micro-services</li></ul><p id="b4f3f602-5a6f-4921-9b57-dd57111635fa" class=""><strong>In proxy the server doesn&#x27;t know who the client is, And in reverse proxy the client doesn&#x27;t know which server is serving the content</strong></p><p id="85396569-64fc-4129-bf1e-4f822b3833bb" class="">A simplified way to sum it up would be to say that a forward proxy sits in front of a client and ensures that no origin server ever communicates directly with that specific client. On the other hand, <strong>a reverse proxy sits in front of an origin server and ensures that no client ever communicates directly with that origin server</strong>.</p><p id="0ffec848-9f59-4e74-b0e5-6222d23e3ca8" class="">
</p><p id="3924820f-20c8-41a0-9708-573b97c23a97" class=""><strong>DISADVANTAGE</strong></p><p id="e8f140ad-b9fd-4b12-b184-f5cd520dc245" class="">A reverse proxy can be a single point of failure, can be fixed with introducing multiple proxies but then it becomes more complex system.</p><h2 id="0bea2ea7-e89f-4745-b7f3-da4e1a96537b" class="">→ QUEUE</h2><p id="cab7b4a1-af82-4682-82b2-9554375a8570" class="">
</p><p id="59790264-290d-48a3-bddb-b8b5d09261dc" class="">Message queuing makes it possible for applications to communicate asynchronously, by sending messages to each other via a queue. A message queue provides temporary storage between the sender and the receiver so that the sender can keep operating without interruption when the destination program is busy or not connected</p><p id="c8fa3820-63b6-4218-9d7c-039a29a2e57b" class=""><em><strong>Asynchronous processing</strong></em> allows a task to call a service, and <em>move on to the next task</em> while the service processes the request at its own pace.</p><p id="c98fdb5b-484a-4bf9-b192-0c9716e39c6d" class="">A <strong>queue</strong> is a line of things waiting to be handled — in sequential order starting at the beginning of the line. A <strong>message queue</strong> is a queue of messages sent between applications. It includes a sequence of work objects that are waiting to be processed.</p><p id="aac4b00f-970c-44f4-bdb2-c644706c20d1" class="">A <strong>message</strong> is the data transported between the sender and the receiver application; it’s essentially a byte array with some headers on top. An example of a message could be an event. One application tells another application to start processing a specific task via the queue.</p><p id="c9bb8493-c9a8-4e0b-8225-0a70ef336d6f" class="">The basic architecture of a <strong>message queue</strong> is simple: there are client applications called <strong>producers</strong> that create messages and deliver them to the message queue. Another application, called a <strong>consumer</strong>, connects to the queue and gets the messages to be processed.</p><p id="863ed7ec-613b-45fb-b4ea-806d45e72c92" class=""><strong>Examples</strong> of queues: <strong>Kafka, Heron, real-time streaming, Amazon SQS, and RabbitMQ.</strong></p><p id="14b4ede8-a668-4f71-9c2f-30fae3b19962" class="">NoSQL databases, by contrast, are quite fast, but many times they lack reliability. So, when building queues, we should use fast, reliable, concurrency enabled tools such as <a href="https://www.rabbitmq.com/">RabbitMQ</a>, <a href="https://redis.io/">Redis</a> and <a href="https://aws.amazon.com/pt/sqs/">SQS</a>.</p><h3 id="29c54640-cae4-4f2c-b0b4-b353f51458dd" class="">Microservice</h3><p id="d38f6015-670f-4301-8bfc-63ab6f6e0a23" class="">Typically, in a microservice architecture, there are cross-dependencies, which entail that no single service can perform its functionalities without getting help from other services. <strong>This is where it’s crucial for your system to have a mechanism in place which allows services to keep in touch with each other without getting blocked by responses.</strong></p><p id="c552eddc-8d9d-4be3-be3e-487d16b175fe" class="">Message queuing fulfills this purpose by providing a means for services to push messages to a queue asynchronously and ensure that they get delivered to the correct destination. To implement a message queue between services, you need a <strong>message broker, think of it as a mailman</strong>, who takes mail from a sender and delivers it to the correct destination.</p><p id="719963ce-a2ba-42c8-b89d-1b76bc0ed6d3" class="">
</p><h3 id="7da4769a-1f8d-4468-8548-9dd8b43506e6" class="">Components</h3><ul id="c6c978ce-c4fe-490a-889b-23a7d68b39fb" class="bulleted-list"><li style="list-style-type:disc">A <strong>message broker</strong><ul id="00de444f-d8c1-4cd6-93fd-2000542b8bb3" class="bulleted-list"><li style="list-style-type:circle">To initiate a task the client adds a message to the queue, the broker then delivers that message to a worker.</li></ul><ul id="cbceb84d-ad90-4db3-8b8c-79f55d7a94c3" class="bulleted-list"><li style="list-style-type:circle">Components of a <strong>message broker</strong><ul id="14bff976-7955-4ced-8ddb-1f9586a73ca6" class="bulleted-list"><li style="list-style-type:square">A <strong>message router</strong> manages routing and delivery of messages</li></ul><ul id="a7b74182-b196-4dc9-9629-7d7f773f7c52" class="bulleted-list"><li style="list-style-type:square"><strong>Connection Service </strong>manages physical connection between broker and client</li></ul><ul id="7619fc1f-77bd-40a3-8c3b-0034e9e6d5fc" class="bulleted-list"><li style="list-style-type:square"><strong>Persistence Manager </strong> manages write of data to persistence storage</li></ul><ul id="70955afe-7e57-4dee-848b-69c7eeb0171f" class="bulleted-list"><li style="list-style-type:square"><strong>Security Manager </strong> provides authentication to client requesting connection to broker</li></ul><ul id="01acdddb-a507-4fff-96d6-728be1253979" class="bulleted-list"><li style="list-style-type:square"><strong>Monitoring Service</strong> generates metrics and diagnostics for monitoring purposes</li></ul></li></ul></li></ul><ul id="4ffd6fa8-3153-4975-8440-f26a8158c238" class="bulleted-list"><li style="list-style-type:disc">Types of concurrency<ul id="ade9269d-f504-48e4-ae39-8fee90c26368" class="bulleted-list"><li style="list-style-type:circle">Pre Fork → Multi processing</li></ul><ul id="1c0e0698-19ef-49c3-9d4b-210eb1082ec5" class="bulleted-list"><li style="list-style-type:circle">Thread → Multithreaded</li></ul><ul id="a372d5e1-d54a-4fa9-803c-f6167fcc1fa4" class="bulleted-list"><li style="list-style-type:circle">eventlet, gevent</li></ul><ul id="d5f9f399-ef4d-4bc7-aa5a-f38a32899712" class="bulleted-list"><li style="list-style-type:circle">solo → single threaded</li></ul></li></ul><ul id="559b4d01-d261-452b-9113-aa43d03d9932" class="bulleted-list"><li style="list-style-type:disc">Result Stores<ul id="ce6a7568-f6d6-4374-a3ec-b98ecca8a900" class="bulleted-list"><li style="list-style-type:circle">Places where the result of a process are stored</li></ul></li></ul><h2 id="c2521674-6c95-4a59-8297-a2bb937cd041" class="">→ PUBSUB</h2><p id="ebd918a3-8f07-46c1-a31c-cdbcfec72c0e" class="">A pub-sub has topic to which lots of consumer can subscribe at once and do certain task whereas a queue system is works serially in FIFO order and once the data is dequeued its gone</p><h3 id="31e414a2-678b-4a97-8762-f56f67a5c555" class="">RabbitMQ</h3><figure id="dfd75e1c-ad92-4e3d-8a71-96b07f48b1bc" class="image"><a href="SYSTEM%20DESIGN%20NOTES%200e5ba93dcf32447494c8e8ed3e53e52a/RabbitMQ.png"><img style="width:612px" src="SYSTEM%20DESIGN%20NOTES%200e5ba93dcf32447494c8e8ed3e53e52a/RabbitMQ.png"/></a></figure><p id="d0608731-6852-4d69-b728-a6807b6c1fc7" class="">RabbitMQ consists of:</p><p id="dc2c9812-2877-42e0-801b-104fa6eeae1d" class="">1. producer — the client that creates a message</p><p id="8ee97ba3-d096-4c23-88ac-42c75784917b" class="">2. consumer — receives a message</p><p id="c9441194-62c8-4f07-9033-a4a73a4f208d" class="">3. queue — stores messages</p><p id="d1f98638-a37e-498e-9ff1-1d9ab505f824" class="">4. exchange — enables to route messages and send them to queues</p><p id="9124997a-6de3-4f91-a762-ffd77ef77fc9" class="">
</p><h3 id="82c1ae59-ccfc-4994-9590-cae8495b9252" class="">Apache Kafka</h3><figure id="f2a9eeb8-168c-4bc5-bb11-ba0bcd6ea076" class="image"><a href="SYSTEM%20DESIGN%20NOTES%200e5ba93dcf32447494c8e8ed3e53e52a/apache-kafka.png"><img style="width:700px" src="SYSTEM%20DESIGN%20NOTES%200e5ba93dcf32447494c8e8ed3e53e52a/apache-kafka.png"/></a></figure><h3 id="cb7092cb-3dea-48b9-9dc8-e2c92caa8bf7" class="">Celery</h3><p id="f4c252f5-d12b-4468-a615-e05c6b9859cd" class="">Celery communicates via messages, usually using a broker to mediate between clients and workers. To initiate a task the client adds a message to the queue, the broker then delivers that message to a worker.</p><p id="a7f5e8b4-bbe5-49a5-be96-2a116f265938" class="">A Celery system can consist of multiple workers and brokers, giving way to high availability and horizontal scaling.</p><h3 id="9e58e379-74da-4b46-8e98-2ed6d3d6e92c" class="">Huey</h3><ul id="3ec65056-ff2a-46a9-a03c-33281829204c" class="bulleted-list"><li style="list-style-type:disc">multi-process, multi-thread or green-let task execution models</li></ul><ul id="9a1449e3-d1b0-4d9a-992d-b38ba0f70654" class="bulleted-list"><li style="list-style-type:disc">schedule recurring tasks, like a crontab, or after a given delay</li></ul><ul id="66777cc2-5c11-4225-83fd-acb55b5ee6e0" class="bulleted-list"><li style="list-style-type:disc">task prioritisation, result storage, task expiration, task locking, task pipelines and chains, automated retry</li></ul><p id="ee124610-cb7f-406c-9ea8-41aff26fbc8f" class="">
</p><h2 id="04e904f9-bcd6-4a4d-9a98-e6e16257a117" class="">→ DATABASE</h2><p id="02a6f59b-bb69-4748-9fa9-9a62e0a800ed" class="">
</p><blockquote id="9ada47f6-25f2-4224-a888-fb9a820f4c2a" class=""><strong>Relational database management system (RDBMS)</strong></blockquote><p id="08e64bcb-cb95-440d-875b-6f388d4e3dda" class="">
</p><p id="4086430a-e84e-4b7b-8312-449a1dcdee91" class="">Collection of data organised into tables. </p><p id="61f94c55-dbc5-430f-b568-6afeddfc6637" class=""><strong>ACID → </strong></p><ul id="7fbe8d4f-bae1-493e-9a4e-03046061a7c2" class="bulleted-list"><li style="list-style-type:disc"><strong>Atomicity</strong> ⇒ Either all or none</li></ul><ul id="8e85a897-5c6d-4c68-9425-b66aba51907a" class="bulleted-list"><li style="list-style-type:disc"><strong>Consistency</strong> ⇒ State before and after transaction should be valid (consistent)</li></ul><ul id="137b35fb-7857-40c6-8edd-1a8f8f3d83bc" class="bulleted-list"><li style="list-style-type:disc"><strong>Isolation</strong> ⇒ concurrent(parallel) transaction should be same as serial</li></ul><ul id="820d5233-d26c-4773-b6fb-7c1fccc9eca6" class="bulleted-list"><li style="list-style-type:disc"><strong>Durable</strong> ⇒ Should be persistent after a transaction.</li></ul><p id="a479f075-2277-4f32-a202-4fa9004de478" class="">To reduce redundancy and improve consistency, people follow 3NF when designing database schemas:</p><ul id="13913d43-b801-4693-89cc-8f30f59e5d29" class="bulleted-list"><li style="list-style-type:disc"><strong>1NF</strong>: tabular, each row-column intersection contains only one value</li></ul><ul id="656f94e7-32b2-469d-a8a0-059361b76024" class="bulleted-list"><li style="list-style-type:disc"><strong>2NF</strong>: only the primary key determines all the attributes</li></ul><ul id="59185334-b54b-4e77-863f-c91a0a50318e" class="bulleted-list"><li style="list-style-type:disc"><strong>3NF</strong>: only the candidate keys determine all the attributes (and non-prime attributes do not depend on each other)</li></ul><p id="01e02edb-8850-43c7-854b-d7925c3ef5de" class=""><strong>WAYS TO SCALE → </strong></p><ul id="003d6ed5-5df3-4aeb-b9d5-107faf732e16" class="bulleted-list"><li style="list-style-type:disc"><strong>Master-slave replication ⇒ </strong>All writes to a master are written to slave and slave can replicate data to other slave, if master fails → a read can happen from a slave until one is promoted as master, or a new master is added.<ul id="8167492c-3e99-4fb0-b66a-ca5465212dc0" class="bulleted-list"><li style="list-style-type:circle">Master ⇒ both read and write, Slave ⇒ read only</li></ul><ul id="2b84f03a-54ff-4466-98b6-024ff3d69e46" class="block-color-red_background bulleted-list"><li style="list-style-type:circle">Extras logic for promotion of slave to master must be provided</li></ul></li></ul><ul id="81fe0c05-1e54-4de2-87ee-7dc087886927" class="bulleted-list"><li style="list-style-type:disc"><strong>Master-master replication ⇒ </strong>Both masters provide read/write. If one fails other comes up.<ul id="5db7dc91-f4fd-4cff-993d-809c51fa60b1" class="block-color-red_background bulleted-list"><li style="list-style-type:circle">Will need load balancer to route between nodes</li></ul><ul id="d745114e-d822-4097-9393-c0a28ad341fb" class="block-color-red_background bulleted-list"><li style="list-style-type:circle">Syncing data between nodes⇒ has high latency ⇒ violating ACID</li></ul></li></ul><p id="2ee491c8-3164-4243-8150-43407442b490" class="">
</p><p id="0ae3af21-9c7c-465e-a37f-26dfb2e91fd9" class="">When the master fails before writing the new data to replicas then ACID is violated, lots of replicas means lots of writes ⇒ leading to lots of lags. Also replication is a costly process.</p><p id="611d5abd-d606-410e-8c75-496c56fc976c" class=""><strong>FEDERATION</strong></p><p id="3f543a55-4288-4b5d-8351-cc9f3b6eba9a" class="">Federation splits up database based on a function (of traffic, application logic etc). Pushing table or a group of tables with similar motive into separate database can make it more effective and memory efficient ⇒ more cache hits.</p><ul id="fce96568-6055-40b5-b09d-86f1ab6b2227" class="bulleted-list"><li style="list-style-type:disc">Federation is not logical if schema has huge table, separating makes no sense. Joining tables from multiple database is complex and will need application logics while reading or writing data. After all more database means it is costlier</li></ul><p id="6c1cd625-8fe9-4d44-b4db-be18223caad7" class=""><strong>SHARDING</strong></p><p id="9486b844-61ec-47a0-9190-987a6c974ded" class="">SHARDING splits the database into smaller subsets for faster access, and as the data increases more shards are created. Consider splitting the users table based in <strong>customer_id</strong></p><p id="72f15921-abb8-4a9c-803a-21801b5cd403" class="">Split happens based on a function <div class="indented"><ul id="0a9278ce-2a7f-4275-be4a-516e8015bc76" class="bulleted-list"><li style="list-style-type:disc">key is generally derived using a hash function, or a master table containing the records where each entry is located (some master table)</li></ul><ul id="309b48ce-cab3-42b1-b56d-ca56d8753fa7" class="bulleted-list"><li style="list-style-type:disc">so that when we need to access a data we know which shard it belongs to for fast access</li></ul><ul id="a6aee53b-ee2b-48a0-ab5f-d0787922d6cb" class="bulleted-list"><li style="list-style-type:disc">when a requests comes in we need to hit that intermediate layer which decides where my data is located, its really expensive</li></ul><figure id="a4de5c1e-6e5c-40eb-bea2-28a8619328ec" class="image"><a href="SYSTEM%20DESIGN%20NOTES%200e5ba93dcf32447494c8e8ed3e53e52a/Screenshot_from_2021-11-02_09-26-12.png"><img style="width:641px" src="SYSTEM%20DESIGN%20NOTES%200e5ba93dcf32447494c8e8ed3e53e52a/Screenshot_from_2021-11-02_09-26-12.png"/></a></figure><p id="aa9d85b0-f7e1-4211-94fe-50a72f83ab67" class=""><strong>Advantage ⇒ </strong>Less read and write from a single database⇒ high throughput, more cache hits, less index for individual DB. if one shards is down , there is partial data loss</p><p id="b7474184-ac3d-402a-8a90-1fae58062d22" class=""><strong>Disadvantage ⇒ </strong>A set of shard may be hit more often, like a power user may have more activity and that users shard will be hot more often. Also joining data from shards is complex. And like federation its costly</p><p id="bfe5351e-5f44-4831-923f-95ccefeb1b5a" class="">
</p></div></p><p id="cb81659a-542b-48b7-9376-166e19561ed3" class=""><strong>DENORMALIZATION</strong></p><p id="7715a492-18a3-4d82-8366-a5f0cc90bef8" class=""><strong>Denormalization</strong> is a strategy used on a previously <a href="https://en.wikipedia.org/wiki/Database_normalization">normalised</a> database to increase performance. In <a href="https://en.wikipedia.org/wiki/Computing">computing</a>, denormalisation is the process of trying to improve the read performance of a <a href="https://en.wikipedia.org/wiki/Database">database</a>, at the expense of losing some write performance, by adding <a href="https://en.wikipedia.org/wiki/Redundancy_(information_theory)">redundant</a> copies of data or by grouping data. It is often motivated by <a href="https://en.wikipedia.org/wiki/Computer_performance">performance</a> or <a href="https://en.wikipedia.org/wiki/Scalability">scalability</a> in <a href="https://en.wikipedia.org/wiki/Relational_model">relational</a> <a href="https://en.wikipedia.org/wiki/DBMS">database software</a> needing to carry out very large numbers of read operations.</p><p id="0a5b8dcb-7047-4188-b63b-97445957fc18" class=""> In most systems, reads can heavily outnumber writes 100:1 or even 1000:1. A read resulting in a complex database join can be very expensive, spending a significant amount of time on disk operations. Denormalisation might circumvent the need for such complex joins.</p><p id="c34a1409-6105-4bb7-b3d7-90afe9552a5f" class=""><strong>Disadvantages → </strong>Data is duplicated. A denormalised database under heavy write load might perform worse than its normalised counterpart.</p><p id="7be20276-2fa8-4055-ad18-69a8a4e6b0b7" class="">
</p><p id="fa7a1a96-cc54-4e98-a4a3-08dfd5e318e8" class=""><strong>SQL TUNING</strong></p><p id="caa16de0-c3d4-47c8-9043-19a8989c6ce2" class="">It&#x27;s important to <strong>benchmark</strong> and <strong>profile</strong> to simulate and uncover bottlenecks.</p><ul id="8ad8c850-5c7b-4cca-b352-9aef36134629" class="bulleted-list"><li style="list-style-type:disc">Use <code>CHAR</code> instead of <code>VARCHAR</code> for fixed-length fields. As with <code>varchar</code> you must find the end of the string</li></ul><ul id="926519c1-56bf-4a6c-a3a9-79402765acb0" class="bulleted-list"><li style="list-style-type:disc">Use <code>TEXT</code> for large text blocks. useful for search</li></ul><ul id="b23924ed-f609-40f3-b4ab-4c6ebdbdb7df" class="bulleted-list"><li style="list-style-type:disc">Use <code>INT</code> for large integer 2^32 or 4 billion</li></ul><ul id="b11c5d48-5a46-4246-ba8f-ec75ffd6081a" class="bulleted-list"><li style="list-style-type:disc">Use <code>DECIMAL</code> for currency to avoid floating point representation errors.</li></ul><ul id="d26d01b9-b91a-4868-92b6-a83644c571c0" class="bulleted-list"><li style="list-style-type:disc">Avoid storing large blobs, like file blobs or images</li></ul><ul id="6bc6c606-0c26-468d-8fa5-737f914d1db3" class="bulleted-list"><li style="list-style-type:disc">Use proper indexing for commonly used queries<ul id="2e1a15da-ed5e-445c-b32d-45036e8f4f37" class="bulleted-list"><li style="list-style-type:circle">keeps data in memory, in a self balancing B-tree, with sorting and faster searches and CRUDS</li></ul></li></ul><ul id="5d65ffe2-4138-41a2-b3c9-fb957302c12e" class="bulleted-list"><li style="list-style-type:disc">Avoid expensive joins</li></ul><p id="d9803927-1f05-49ab-a38f-ec86da008204" class="">
</p><blockquote id="6c1c0ef6-3650-466f-8d8b-e33d89819ad2" class=""><strong>NoSQL</strong></blockquote><p id="832d3261-0102-4c4f-8f1f-8529316af9b7" class="">
</p><p id="e27ee83e-28cc-434d-8474-bf26e9b938e5" class="">Collection of data items represented in a <strong>Key-value Store, Document Store, Wide column store,</strong> <strong>or graph database </strong>. </p><ul id="6b58cfb5-cd1f-4b1e-a8b0-a80b8c63ab00" class="bulleted-list"><li style="list-style-type:disc">Denormalised data</li></ul><ul id="adbe0e7b-7d3a-4715-8428-9eda8d8b340d" class="bulleted-list"><li style="list-style-type:disc">Joins happen in application</li></ul><ul id="2c4f3818-701a-4814-beb7-6eb498448bdc" class="bulleted-list"><li style="list-style-type:disc">Lacks ACID and favours <strong>eventual consistency</strong></li></ul><ul id="7ef6df35-3903-4d78-827e-e3a06933f963" class="bulleted-list"><li style="list-style-type:disc"><strong>BASE → </strong>Basically available (guaranteed availability), soft state (state of the system may change over time, without intervention), eventual consistency (consistency over time)</li></ul><ul id="40c83a9d-e2d8-494f-824a-8e1fba4a0d8f" class="bulleted-list"><li style="list-style-type:disc">Although most NoSQL takes BASE priciples, they are learning from or moving toward ACID. e.g. Google Spanner provides strong consistency. MongoDB 4.0 adds support for multi-document ACID transactions.</li></ul><p id="1f145b85-bcf0-43fb-9fce-f6e4a106c855" class=""><strong>TYPES OF NO SQL</strong></p><ul id="3db6fbac-db7f-4934-8f3e-1083a2ab33b1" class="bulleted-list"><li style="list-style-type:disc"><strong>Key-value store → </strong>O(1) reads and write. high-performance, often memory or ssd is used , sometime keys are stored in lexicographic order, provides limited set of operation (like get and put).<p id="fdaf6bcb-0d5c-4445-ae83-5d34c45e13fe" class="">Out-of-box choices: Redis/Memcache? Redis supports data persistence while Memcache does not. Riak, Berkeley DB, HamsterDB, Amazon Dynamo, Project Voldemort, etc</p></li></ul><ul id="00b4d83d-4fee-47bf-962f-5e194fab5806" class="bulleted-list"><li style="list-style-type:disc"><strong>Document store → </strong>Documents like xml, json , binary store are saved as objects. They provide api or a query language to query based on the internal structure of the document. Based on the underlying implementation, documents are organised by collections, tags, metadata or directories. The main reason we want to use a document store is for flexibility and performance. Flexibility is achieved by the schemaless document, and performance is improved by breaking 3NF. Startup’s business requirements are changing from time to time. Flexible schema empowers them to move fast.<ul id="5f71b394-bec7-4d82-b619-8c19ceef9459" class="bulleted-list"><li style="list-style-type:circle">MongoDB and Couch DB provide SQL like language to perform complex queries</li></ul><ul id="41aa2d9c-8b24-472e-ad2f-c8337490ea35" class="bulleted-list"><li style="list-style-type:circle">Amazon’s DynamoDB supports both key-values and documents</li></ul><p id="85c2ca86-f46c-4759-a436-452f3bd3ba28" class="">Out-of-box choices: MongoDB, CouchDB, Terrastore, OrientDB, RavenDB, etc.</p></li></ul><ul id="d65666f1-6f99-499c-98f9-d634ecdf863d" class="bulleted-list"><li style="list-style-type:disc"><strong>Wide Column Store → </strong>A wide column store&#x27;s basic unit of data is a column (name/value pair). A column can be grouped in column families (analogous to a SQL table). Super column families further group column families. You can access each column independently with a row key<p id="8cbcf8ae-fd89-43b9-be3d-1ed617551d59" class="">The main reason we want to use a column-oriented store is that it is distributed, highly-available, and optimised for write.</p><figure id="65537628-3422-4985-989e-9e05e6c2e47e" class="image"><a href="SYSTEM%20DESIGN%20NOTES%200e5ba93dcf32447494c8e8ed3e53e52a/wide-column.png"><img style="width:581px" src="SYSTEM%20DESIGN%20NOTES%200e5ba93dcf32447494c8e8ed3e53e52a/wide-column.png"/></a></figure><ul id="2b3d30ad-3c75-4b1b-b488-dd04b2ecb8ee" class="bulleted-list"><li style="list-style-type:circle">Google introduced <a href="http://www.read.seas.harvard.edu/~kohler/class/cs239-w08/chang06bigtable.pdf">Bigtable</a> as the first wide column store, which influenced the open-source <a href="https://www.edureka.co/blog/hbase-architecture/">HBase</a> often-used in the Hadoop ecosystem, and <a href="http://docs.datastax.com/en/cassandra/3.0/cassandra/architecture/archIntro.html">Cassandra</a> from Facebook. Stores such as BigTable, HBase, and Cassandra maintain keys in lexicographic order, allowing efficient retrieval of selective key ranges.</li></ul><ul id="d29a796e-2f7e-4c60-9f0e-1122b9a04ad9" class="bulleted-list"><li style="list-style-type:circle">Out-of-box choices: Cassandra, HBase, Hypertable, Amazon SimpleDB, etc.</li></ul></li></ul><ul id="760cb2ac-5d76-4fc0-8fde-75fc6396f99b" class="bulleted-list"><li style="list-style-type:disc"><strong>Graph Database → </strong>Each node is a record and each arc is a relationship. Graph databases are optimised to represent complex relationships with many foreign keys or many-to-many relationships.<ul id="2982323a-2caa-4ede-80d7-69b00a9685d9" class="bulleted-list"><li style="list-style-type:circle">If we use a relational database to store the graph, adding/removing relationships may involve schema changes and data movement, which is not the case when using a graph database. On the other hand, when we create tables in a relational database for the graph, we model based on the traversal we want; if the traversal changes, the data will have to change.</li></ul><ul id="d8c00b01-4264-463f-897c-6294a58d3fd3" class="bulleted-list"><li style="list-style-type:circle">Out-of-box choices: Neo4J, Infinitegraph, OrientDB, FlockDB, etc.</li></ul></li></ul><p id="fbf39134-0f20-4374-bc04-6dd30ded2fc4" class="">
</p><blockquote id="1475706e-073c-4e9e-b4ee-6791196d6d2b" class=""><strong>SQL VS NOSQL</strong></blockquote><p id="b0b3ef96-c505-4e1a-978a-b3d21791973e" class="">Neither of them is a replacement of another. Both have <strong>separate use case</strong>. Both of them are adopting features from one another resulting to <strong>hybrid solutions</strong>. In No SQL, similar documents can be stored in a <strong>collections</strong> , which is analogous to an SQL table. You can store any data you like in any collections → <strong>schema-less</strong> and therefore a lot more inconsistent than a DB with schemas.<div class="indented"><ul id="1bf4e74b-1057-4e28-83d1-13fdac62e8a7" class="bulleted-list"><li style="list-style-type:disc">SQL Schema vs NoSQL Schema-less</li></ul><ul id="c90b4adb-92ea-43e8-ae40-7c80f7fc09be" class="bulleted-list"><li style="list-style-type:disc">SQL Normalisation vs NoSQL Denormalisation</li></ul><ul id="b183688e-15d6-40a6-917c-34ff9f54613b" class="bulleted-list"><li style="list-style-type:disc">SQL Relational JOIN vs NoSQL</li></ul><ul id="d701d08e-5da4-4669-9c82-e91fa8d22edd" class="bulleted-list"><li style="list-style-type:disc">SQL vs NoSQL Data Integrity<ul id="2b1d99cf-710b-48bc-bc8c-408ed85705fc" class="bulleted-list"><li style="list-style-type:circle">Most SQL databases allow you to enforce data integrity rules using foreign key constraints. The same data integrity options are not available in NoSQL databases; you can store what you want regardless of any other documents. Ideally, a single document will be the sole source of all information about an item.</li></ul></li></ul><ul id="30213ce6-0ae8-4f19-a27c-863309ab520a" class="bulleted-list"><li style="list-style-type:disc">SQL vs NoSQL Transactions<ul id="4724f19f-687c-4295-8c23-d8229e8bc352" class="bulleted-list"><li style="list-style-type:circle">In build ACID properties in SQL, whereas in NOSQL there are <a href="http://docs.mongodb.org/manual/core/write-operations-atomicity/"><strong>transaction-like options</strong></a>, but, at the time of writing, these must be manually processed in your code.</li></ul></li></ul><ul id="2cf58d72-52eb-45a2-9e89-3fd9519dd266" class="bulleted-list"><li style="list-style-type:disc">Performance<ul id="2a1eeb00-6718-490c-877b-75777b1fe590" class="bulleted-list"><li style="list-style-type:circle">Simpler Denormalised store of NO-SQL makes it relatively faster, but a well-designed SQL database will almost certainly perform better than a badly designed NoSQL equivalent and vice versa.</li></ul></li></ul><ul id="0f176a04-6f24-4a0c-8971-370fcc502313" class="bulleted-list"><li style="list-style-type:disc">Scaling<ul id="babaf2c8-bf6f-4b58-b580-72270b606464" class="bulleted-list"><li style="list-style-type:circle">SQL can have sharding, federation and replication for scaling up , but NoSQL’s simpler data models can make it easier to scale</li></ul></li></ul><ul id="a9ad6ed4-ea07-4cf4-982a-e564d80e451a" class="bulleted-list"><li style="list-style-type:disc">Security<ul id="4f61c02e-0af2-4232-beab-e637a62c1e40" class="bulleted-list"><li style="list-style-type:circle">No-SQL being new do have more vulnerability as compared to mature SQL</li></ul></li></ul></div></p><p id="754abbc8-72bc-455d-b3ad-d5b7756cf0c4" class=""><strong>SQL</strong> should be used where there is logically related data, integrity is priority, need complex joins</p><p id="8e7e9fcb-ecb9-4a55-a58d-421c1c232883" class=""><strong>No SQL</strong> should be used where data is unrelated and evolving data models. speed and scalability is important.</p><p id="9a7f94b2-81f1-421e-b1ae-c7513f8e9cad" class="">
</p><p id="6dd2c2ce-1078-436d-857b-fd6647fa93af" class=""><strong>ACID VS BASE (SMACKDOWN)</strong></p><p id="9ee1ace1-b917-48f0-ad09-6bc248499237" class="">
</p><p id="0b070d17-8329-4e57-a0a8-9ab2f06d8d49" class="">
</p><h2 id="4e3dcafa-7a76-4f2e-bc73-0e23942de04f" class="">→ CACHING</h2><figure id="db4da962-408e-4c50-8e51-46e3c468fa49" class="image"><a href="SYSTEM%20DESIGN%20NOTES%200e5ba93dcf32447494c8e8ed3e53e52a/CACHE.png"><img style="width:1032px" src="SYSTEM%20DESIGN%20NOTES%200e5ba93dcf32447494c8e8ed3e53e52a/CACHE.png"/></a></figure><p id="bed3834f-a8c1-47c9-82f3-a2bea794e219" class="">Dispatcher will first look up if the request has been made before and tries to fetch the result from cache without hitting the database. Frequently fetched objects can be cached and prevent from uneven database hits → decreasing the traffic.</p><p id="5932c5c0-3385-4238-8403-ac70992c88e2" class="">Caching can happen in <strong>Client-side</strong> (OS and browser), <strong>CDN</strong> <strong>level </strong>, <strong>server level </strong> like nginx and varnish, <strong>database level </strong>, <strong>application based </strong>(memcached or redis ). </p><p id="4b646e5a-5d3f-48d5-905d-8c9e93c460b9" class="">Avoid caching at database level → if one data changes, entire cache needs to be refreshed. </p><p id="5e9d1cca-cfa6-4011-b250-92952aef7709" class="">Cache, user-session, static content, activity stream etc.</p><pre id="3f2ff431-81d6-4fa4-85e1-cea9f67f5fe5" class="code"><code># SAMPLE CODE TO FETCH AS USER
def get_user(self, user_id):
    user = cache.get(&quot;user.{0}&quot;, user_id)
    if user is None:
        user = db.query(&quot;SELECT * FROM users WHERE user_id = {0}&quot;, user_id)
        if user is not None:
            key = &quot;user.{0}&quot;.format(user_id)
            cache.set(key, json.dumps(user))
    return user</code></pre><p id="a11fa21d-fb13-4f82-9390-d90de8096e50" class="">
</p><p id="dc6a70a7-b679-47fb-8889-6733777075c9" class=""><strong>CONCEPTS</strong></p><ol type="1" id="9403a21a-ca60-40d8-8efe-26c52c3e5fcf" class="numbered-list" start="1"><li><strong>ReadThrough :-</strong> while reading a data we first check if its present in cache , if not we query the database.</li></ol><ol type="1" id="2c26e148-0341-4020-baad-ef362f8a4593" class="numbered-list" start="2"><li><strong>Write Through :-</strong> data is <strong>simultaneously updated to cache and memory</strong>. This process is simpler and more reliable. it mean we wrote through the cache to the database.<p id="5e8df2df-82f6-4dd0-a771-0680b49f637e" class="">This is used when there are no frequent writes to the cache (The number of write operations is less). Data is <strong>reliable</strong>as the main memory always has an up-to-date copy of the line. So when a read is done, main memory can always reply with the requested data.</p><p id="db311673-8a72-454d-b670-25b0ce63f4f2" class="">A data write will experience <strong>latency</strong> (delay) as we have to write to two locations (both Memory and Cache). it questions the advantage of having a cache in write operation. In a distributed system if the cache is attached to the servers, there can be <strong>inconsistency</strong> while updating the server.</p></li></ol><ol type="1" id="fb1d32f3-ef37-4397-9285-67f3bd4b3f10" class="numbered-list" start="3"><li><strong>Write Back :-</strong> The data is updated only in the cache and updated into the memory(DB) at a later time. Data is updated in the memory(DB) only when the cache line is ready to be replaced, probably some asynchronous non blocking. Its caches responsibility to update the database.<p id="68bae93b-f8ea-4c4a-aec7-d10542f68cf8" class="">Algos to update Write back cache includes :-Belady’s Anomaly, LRU, FIFO, LIFO</p><p id="80073275-2b92-4cdc-a193-a330c9acc341" class=""><strong>Dirty Bit</strong>: Each Block in the cache needs a bit to indicate if the data present in the cache was modified(Dirty) or not modified(Clean). If it is clean there is no need to write it into the memory. It is designed to reduce write operation to a memory. If <strong>Cache fails</strong> or if the <strong>System fails or power</strong> outages the modified data will be lost. Because it’s nearly impossible to restore data from cache if lost.</p></li></ol><ol type="1" id="22832bec-9120-457c-94d7-9b150e4a1fa1" class="numbered-list" start="4"><li><strong>Write Around :-</strong> Data is written into the DB first (going around the cache), and when we try to fetch it from cache and it misses then we update the cache from DB</li></ol><p id="df4a8ab8-ad64-40ed-954c-172900a6e739" class=""><strong>TERMS</strong></p><p id="007273c0-cfee-45b1-ba0f-9495c0c5ffba" class=""><strong>Cache Policy</strong> :- A cache eviction algorithm is <strong>a way of deciding which element to evict when the cache is full</strong>.</p><p id="cbe553d2-c138-412d-93df-f033829a715c" class=""><strong>Spatial Cache :-</strong> While fetching from cache if a system fetches all the nearby data which might be required</p><p id="07cd25db-3e67-4d71-89b3-32b58d4cae07" class=""><strong>Temporal Cache :-</strong> Keeping the most used in top</p><p id="e8a17984-4b78-477c-a8c9-5f1b859ace51" class=""><strong>Cache thrash</strong> is caused by an ongoing computer activity that fails to progress due to excessive use of resources or conflicts in the caching system. A key sign of cache thrashing is high <a href="https://whatis.techtarget.com/definition/processor">CPU</a> usage or a system that seems to be running very slowly. In thrashing, the computer will typically take the same actions over and over in an attempt to complete the desired task.</p><ul id="aa4535af-1e57-4f2c-8573-f2de4953d3ce" class="to-do-list"><li><div class="checkbox checkbox-off"></div> <span class="to-do-children-unchecked"> <strong>Possible Question for Interview</strong> :- Implement LRU using link list</span></li></ul><h3 id="826a9bc6-8dd0-49bf-bfc6-4bbe1b6c607a" class=""><strong>Disadvantage(s): cache</strong></h3><ul id="6acfae5e-55d6-406e-bbff-0ba2bde91a26" class="bulleted-list"><li style="list-style-type:disc">Need to maintain consistency between caches and the source of truth such as the database through <a href="https://en.wikipedia.org/wiki/Cache_algorithms">cache invalidation</a>.</li></ul><ul id="516231a4-c031-4de9-92e1-488494b5fb7d" class="bulleted-list"><li style="list-style-type:disc">Cache invalidation is a difficult problem, there is additional complexity associated with when to update the cache.</li></ul><ul id="4bc548f7-4dfe-4fb6-a883-c2fcf01afbfe" class="bulleted-list"><li style="list-style-type:disc">Need to make application changes such as adding Redis or memcached.</li></ul><p id="9b0f2ded-5750-401c-8fa6-4dbb108f210c" class=""><strong>There are three major factors to consider when we design the cache.</strong></p><ol type="1" id="af6cdfe6-53c8-41fa-979a-896e3a34a593" class="numbered-list" start="1"><li><strong>Pattern</strong>: How to cache? is it read-through/write-through/write-around/write-back/cache-aside?</li></ol><ol type="1" id="b3e5887a-d7a6-4ecd-ab69-021758aa11e2" class="numbered-list" start="2"><li><strong>Placement</strong>: Where to place the cache? client-side/distinct layer/server side?</li></ol><ol type="1" id="1a73e5e8-ea16-43da-9c28-d94276a22a97" class="numbered-list" start="3"><li><strong>Replacement</strong>: When to expire/replace the data? LRU/LFU/ARC?</li></ol><h2 id="e21074fc-456d-42e7-8b08-975dfa64644d" class="">→ LOCKS</h2><p id="9c576538-7b51-4c2e-a488-fbbcbff330b5" class="">Lets say you are booking a ticket on a theater, then for a certain period a lock is applied to a seat so that we can complete the transaction and book the seat</p><h3 id="e4b5d396-53f6-4364-a0db-41adc9ca42de" class="">Optimistic Locking</h3><p id="36a4d497-8fe4-412b-9aae-bbf71b627e65" class="">It is a strategy where you read , take a note of version number or timestamps or checksum/hashes and check the version number and checksum before writing back the record. If the checksum and version Number doesn&#x27;t match we discard the record. Here we are optimistic that another transaction has not updated the data. Its helpful when there are lots of reads than writes .</p><p id="6857773b-3b1b-4bff-b3de-b686de296df8" class="">Optimistic locking is used when you don&#x27;t expect many collisions. It costs less to do a normal operation but if the collision DOES occur you would pay a higher price to resolve it as the transaction is aborted.</p><h3 id="52e03b15-af4c-4cc2-a83c-8e7957a68e7c" class="">Pessimistic Locking</h3><p id="ed20b76e-47b7-4a95-b1b0-a9127f2f6746" class="">Pessimistic locking is used when a collision is anticipated. The transactions which would violate synchronization are simply blocked.</p><p id="a24a7d47-590c-47e0-aadd-77fa18a39efc" class="">Pessimistic locking is useful if there are a lot of updates and relatively high chances of users trying to update data at the same time. For example, if each operation can update a large number of records at a time (the bank might add interest earnings to every account at the end of each month), and two applications are running such operations at the same time, they will have conflicts.</p><p id="d0d86670-eca4-4bdb-9444-6ad90cd11ecd" class="">Pessimistic locking is also more appropriate in applications that contain small tables that are frequently updated. In the case of these so-called hotspots, conflicts are so probable that optimistic locking wastes effort in rolling back conflicting transactions.</p><p id="1075ff1d-8bda-476a-b9ca-deb6a5df8540" class="">Refer : </p><figure id="7ba8ce1d-0ce8-4360-9627-ec6ea723ad2a"><div class="source"><a href="https://eugene-eeo.github.io/blog/optlock.html">https://eugene-eeo.github.io/blog/optlock.html</a></div></figure><p id="d8b795fe-fb02-4b57-9d06-a091474dbbb8" class="">
</p><p id="e97ddb49-1dc5-4747-871b-b7213f703321" class="">
</p><h2 id="01a0c6bf-8e79-4500-92e3-ee4af9cf9f55" class="">→ CONSISTENCE HASHING</h2><p id="bebacebd-b788-4468-9d16-4cbb263fc7fd" class="">A hash function is a function that maps one piece of data—typically describing some kind of object, often of arbitrary size—to another piece of data, typically an integer, known as <em>hash code</em>, or simply <em>hash</em>.</p><p id="a886f171-3041-4581-aa6e-85e355f7587e" class="">Good hash functions should somehow “chop and mix” (hence the term) the input data in such a way that the outputs for different input values are spread as evenly as possible over the output range.</p><p id="46c8247b-494b-4c6a-b0e2-49d822d8e66f" class=""><strong>Distributed Hashing</strong></p><p id="bf8b0310-3478-4630-8507-7de12bc357cc" class="">It may be necessary or desirable to split a hash table into several parts, hosted by different servers.One of the main motivations for this is to bypass the memory limitations of using a single computer, allowing for the construction of arbitrarily large hash tables ⇒ **Horizontal scaling .**In such a scenario, the objects (and their keys) are <em>distributed</em> among several servers, hence the name. Eg :- <em>Memcached</em></p><p id="02ee0de4-86b4-4ae5-b0b2-1f5ab3e6a93c" class=""><strong>TECHNIQUE</strong></p><p id="82515ba1-5bde-4473-9dc3-b0e5028dab0e" class="">To set or get the server location for a key we do</p><p id="00648c5b-bbad-4540-8a25-41f414c1182c" class=""><strong>Server = hash(key) mod N</strong></p><p id="6a4e0bd5-ffec-4f5a-9aa2-a7f253f0e177" class=""><code>N</code> is the size of the pool</p><p id="08f23c29-cde9-47f8-add3-548224c29108" class="">The hash function used for key distribution must be the same one across all clients,</p><p id="b69ff073-f7a1-4e8b-8cb5-2029d87d6911" class=""><strong>ISSUE</strong></p><p id="836d5d7d-1fd4-4759-a215-7c021aef2b7e" class="">What happens if one of the servers crashes or becomes unavailable? Keys need to be redistributed to account for the missing server, of course.</p><p id="3249363f-3c39-4f3b-88de-3fd760899d65" class="">The same applies if one or more new servers are added to the pool;keys need to be redistributed to include the new servers</p><p id="05235b19-fa23-48fe-bc85-3661d09595b5" class="">So, even if a single server is removed or added, all keys will likely need to be rehashed into a different server.</p><p id="450d24c9-e870-4472-8a4a-5737891c5b50" class=""><strong>Consistence Hashing</strong></p><p id="8ae30a00-0b37-4b99-978d-c2095ee2865f" class="">Consistent Hashing is a distributed hashing scheme that operates independently of the number of servers or objects in a distributed <em>hash table</em> by assigning them a position on an abstract circle, or <em>hash ring</em>. This allows servers and objects to scale without affecting the overall system.</p><figure id="33991338-24b3-4e3b-bad6-64928210f670" class="image"><a href="https://uploads.toptal.io/blog/image/129308/toptal-blog-image-1551794723809-3b70e8ff86f1510ad4c24a09bcd3942c.png"><img src="https://uploads.toptal.io/blog/image/129308/toptal-blog-image-1551794723809-3b70e8ff86f1510ad4c24a09bcd3942c.png"/></a></figure><figure id="35a1e246-89fd-425d-b4f6-74c7c1e51ed8" class="image"><a href="SYSTEM%20DESIGN%20NOTES%200e5ba93dcf32447494c8e8ed3e53e52a/Screenshot_from_2021-11-02_10-42-56.png"><img src="SYSTEM%20DESIGN%20NOTES%200e5ba93dcf32447494c8e8ed3e53e52a/Screenshot_from_2021-11-02_10-42-56.png"/></a></figure><ul id="ef80b3ca-f1f3-4542-acbf-1d68377adfb4" class="bulleted-list"><li style="list-style-type:disc">Whenever we remove a server we need to remap some data (previously in normal hashing we needed to remap all data) . we map some of the data to the next available servers</li></ul><ul id="1562d560-854f-42fd-abce-687f39b78da4" class="bulleted-list"><li style="list-style-type:disc">Also after remapping some data we see some of the partitions will have more data (disproportionate distribution of data)</li></ul><ul id="27c3d353-421a-4a93-92d6-27a855caad6e" class="bulleted-list"><li style="list-style-type:disc"><strong>SOLUTION :-</strong> Increasing the number of hash replicas and spreading them through out so that lesser number of keys need to be remapped</li></ul><figure id="dc7ae0c2-ae11-4ede-8505-007b3c8fbf35" class="image"><a href="https://uploads.toptal.io/blog/image/129310/toptal-blog-image-1551794764808-260dc8495f15e76a523f52a512d48acb.png"><img src="https://uploads.toptal.io/blog/image/129310/toptal-blog-image-1551794764808-260dc8495f15e76a523f52a512d48acb.png"/></a></figure><p id="cbbdbdff-915c-4931-b708-eee36905026c" class="">
</p><h2 id="2df37c8d-0655-40dc-a9b9-db7a22d0320c" class="">→ OSI MODEL</h2><p id="859d7ccb-3130-4ec6-b65c-d066d5e20dbd" class="">The <em><strong>O</strong></em><em>pen </em><em><strong>S</strong></em><em>ystem </em><em><strong>I</strong></em><em>nterconnection (</em><a href="https://www.webopedia.com/definitions/osi/"><em>OSI</em></a>) model defines <em>a networking framework to implement protocols in seven layers</em>. There is really nothing to the OSI model. In fact, it’s not even tangible. The OSI model doesn’t perform any functions in the networking process. It is a <em>conceptual framework.</em></p><figure id="3c384e3e-8ac5-4329-bab7-31828207efb8" class="image"><a href="SYSTEM%20DESIGN%20NOTES%200e5ba93dcf32447494c8e8ed3e53e52a/osi.svg"><img src="SYSTEM%20DESIGN%20NOTES%200e5ba93dcf32447494c8e8ed3e53e52a/osi.svg"/></a></figure><p id="f219d698-6e41-462e-841c-8742bc5af193" class="">In this model,</p><ul id="8e0cbf01-7c3c-46b6-aa8a-416979f844df" class="bulleted-list"><li style="list-style-type:disc">layers 1-4 are considered the lower layers, and mostly concern themselves with moving data around.</li></ul><ul id="b3750b76-2381-4652-b656-a44e86623420" class="bulleted-list"><li style="list-style-type:disc">Layers 5-7, called the the upper layers, contain application-level data.</li></ul><figure id="d459f605-e960-4757-a767-d53c2de34ef6" class="image"><a href="SYSTEM%20DESIGN%20NOTES%200e5ba93dcf32447494c8e8ed3e53e52a/Screenshot_from_2021-11-08_09-34-01.png"><img src="SYSTEM%20DESIGN%20NOTES%200e5ba93dcf32447494c8e8ed3e53e52a/Screenshot_from_2021-11-08_09-34-01.png"/></a></figure><p id="8897009a-8402-4fde-97f9-ef9c68eff0cd" class="">Refer :- <a href="https://www.cloudflare.com/en-in/learning/ddos/glossary/open-systems-interconnection-model-osi/">https://www.cloudflare.com/en-in/learning/ddos/glossary/open-systems-interconnection-model-osi/</a></p><p id="207fd157-5dac-4e5a-8084-942ae5246376" class="">
</p><h2 id="8084cd54-f796-46c5-834d-2f819e145711" class="">→ WEB PROTOCOLS</h2><p id="3f9c3f62-a659-4c77-85a7-0dd5aa7ee0a2" class="">
</p><p id="7ea2f1e6-4f30-4ba3-b0d5-812bd69c035e" class=""><strong>Hypertext transfer protocol (HTTP)</strong></p><p id="bfc4606a-20c9-4038-97ae-3fdd6da8340a" class="">HTTP is a method for encoding and transporting data between a client and a server. It is a request/response protocol: clients issue requests and servers issue responses with relevant content and completion status info about the request. HTTP is self-contained, allowing requests and responses to flow through many intermediate routers and servers that perform load balancing, caching, encryption, and compression.</p><p id="304b1eaa-4900-40c9-9988-f1c227f77289" class="">
</p><p id="51d2b167-042b-418c-af42-2a118d00d839" class=""><strong>Transmission control protocol (TCP)</strong></p><p id="528e34a6-61ed-4b18-b93c-215d40baaf15" class="">TCP is a connection-oriented protocol over an <a href="https://en.wikipedia.org/wiki/Internet_Protocol">IP network</a>. Connection is established and terminated using a <a href="https://en.wikipedia.org/wiki/Handshaking">handshake</a>. All packets sent are guaranteed to reach the destination in the original order and without corruption through:</p><ul id="bc146890-89bd-4534-b052-a71efed7bd52" class="bulleted-list"><li style="list-style-type:disc">Sequence numbers and <a href="https://en.wikipedia.org/wiki/Transmission_Control_Protocol#Checksum_computation">checksum fields</a> for each packet</li></ul><ul id="a5d7861d-6986-4169-95b8-d55be1791e3c" class="bulleted-list"><li style="list-style-type:disc"><a href="https://en.wikipedia.org/wiki/Acknowledgement_(data_networks)">Acknowledgement</a> packets and automatic retransmission</li></ul><ul id="a56e3171-3035-4c54-b7e1-850bcb0958d8" class="bulleted-list"><li style="list-style-type:disc">If the sender does not receive a correct response, it will resend the packets. If there are multiple timeouts, the connection is dropped. TCP also implements <a href="https://en.wikipedia.org/wiki/Flow_control_(data)">flow control</a> and <a href="https://en.wikipedia.org/wiki/Network_congestion#Congestion_control">congestion control</a>. These guarantees cause delays and generally result in less efficient transmission than UDP.<p id="20c6e2de-9b5f-41b0-a839-db88c456dc86" class="">TCP is useful for applications that require high reliability but are less time critical. Some examples include web servers, database info, SMTP, FTP, and SSH.</p><p id="29ae1665-319a-40b9-bd23-478ae0161751" class=""><strong>Use TCP over UDP when</strong>:</p><ul id="a0ad11f7-9a74-422d-b8e4-f41f2b15bf87" class="bulleted-list"><li style="list-style-type:circle">You need all of the data to arrive intact</li></ul><ul id="9e17145e-4cc6-4374-8229-23686ebef518" class="bulleted-list"><li style="list-style-type:circle">You want to automatically make a best estimate use of the network throughput</li></ul><p id="a2c41d05-ee05-44dd-934b-4dcba7e1e379" class="">TCP is a transport-layer protocol, and HTTP is an application-layer protocol that runs over TCP</p></li></ul><p id="2ca129c6-f67e-42ac-b96b-ab13dffacf49" class=""><strong>User datagram protocol (UDP)</strong></p><p id="7057428a-6e13-44f8-bdcb-a90ea8bee58d" class="">UDP is connectionless. Datagrams (analogous to packets) are guaranteed only at the datagram level. Datagrams might reach their destination out of order or not at all. UDP does not support congestion control. Without the guarantees that TCP support, UDP is generally more efficient.</p><p id="7d69d715-f928-4919-968c-90f695203911" class="">UDP can broadcast, sending datagrams to all devices on the subnet. This is useful with <a href="https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol">DHCP</a> because the client has not yet received an IP address, thus preventing a way for TCP to stream without the IP address.</p><p id="fc62afc0-a3ad-45be-b95d-15a2d42d256b" class="">UDP is less reliable but works well in real time use cases such as VoIP, video chat, streaming, and realtime multiplayer games.</p><p id="1c1f27a0-6ff1-496d-9d2f-5edfceefcd38" class="">Use UDP over TCP when:</p><ul id="41d3c019-aa72-4823-b5d9-9fe6df3d2de5" class="bulleted-list"><li style="list-style-type:disc">You need the lowest latency</li></ul><ul id="bd8461c4-ff18-4f18-bc54-e81e945cff8c" class="bulleted-list"><li style="list-style-type:disc">Late data is worse than loss of data</li></ul><ul id="0c41336b-632d-4b65-aab3-e1cd2b0daeda" class="bulleted-list"><li style="list-style-type:disc">You want to implement your own error correction</li></ul><table id="a1b4caf5-ac66-4a90-8420-0eedfe3b967a" class="simple-table"><thead><tr id="b1897593-e783-4055-bed4-56a00b057b67"><th id="q}pI" class="simple-table-header">Category</th><th id="EgND" class="simple-table-header">TCP</th><th id="RnOF" class="simple-table-header">UDP</th></tr></thead><tbody><tr id="db623f04-9907-497c-8f8e-8d060968b494"><td id="q}pI">Full-Form</td><td id="EgND">TCP stands for Transmission Control Protocol.</td><td id="RnOF">UDP stands for User Datagram Protocol.</td></tr><tr id="d554c73e-da33-4d68-9e72-9f776c2e905a"><td id="q}pI">Definition</td><td id="EgND">TCP establishes a connection between the computers before sending the data.</td><td id="RnOF">UDP sends the data directly to the destination computer without checking whether the system is ready to receive it or not.</td></tr><tr id="def30ff3-fb3c-456e-9e98-8fcd351fe299"><td id="q}pI">Type of Connection</td><td id="EgND">It is a Connection-oriented protocol representing a connection that should be established before data transmission. The communication devices should end up or remove the connection once the communication is over between the sender and receiver end.</td><td id="RnOF">It is a Connectionless protocol representing no compulsion for creating, maintaining and removing a connection between source and destination end. It is best applicable for broadcast and multicast purposes.</td></tr><tr id="e7e8ef02-2b03-4668-8c22-3e17b527b120"><td id="q}pI">Reliable</td><td id="EgND">TCP is a reliable protocol as it assures the delivery of data packets.</td><td id="RnOF">UDP is an unreliable protocol. It does not affect the guarantee for the delivery of packets.</td></tr><tr id="61f1557d-8fcf-4b7f-9f04-0c63622fe3f3"><td id="q}pI">Retransmissions</td><td id="EgND">Delivery of all data is managed, and lost data is retransmitted automatically.</td><td id="RnOF">It is not performed. An application must detect lost data and retransmit</td></tr><tr id="14ebd8a2-8677-4dee-8554-3f60a3a4575f"><td id="q}pI">Usage</td><td id="EgND">TCP is suited for applications that need high reliability, and when the transmission time is relatively less critical.</td><td id="RnOF">UDP is relevant for applications that require fast, effective transmission, such as games. UDP&#x27;s stateless nature is also helpful for servers that answer small queries from huge numbers of clients.</td></tr><tr id="ffd8d63d-e904-4481-afaa-2f3f0d6f90fc"><td id="q}pI">Error Checking</td><td id="EgND">TCP executes error checking by using a checksum. When the information is corrected, then the data is retransmitted to the receiver.</td><td id="RnOF">It does not implement any error checking and also does not resend the lost data packets.</td></tr><tr id="2d6f50b5-0a6e-4543-be01-3e8a038ccf7b"><td id="q}pI">Streaming of data</td><td id="EgND">Data is learning as a byte flow, and no specific indications are communicated to signal message (segment) boundaries.</td><td id="RnOF">Packets are sent individually and are determined for integrity only if they arrive. Packets have definite boundaries honoured upon receipt, meaning a read operation at the receiver socket will yield an entire message as initially sent.</td></tr></tbody></table><h2 id="5191233f-3280-406a-9026-76339e52ef79" class="">→ Bloom Filters</h2><p id="32dd74cd-8b45-42dc-8e49-6264288a1b49" class="">A Bloom filter is a data structure used to detect whether an element is in a set in a time and space efficient way.</p><p id="46795522-0596-4174-aebf-08016d448fde" class="">False positive matches are possible, but false negatives are not – in other words, a query returns either “possibly in set” or “definitely not in set”. Elements can be added to the set, but not removed (though this can be addressed with a “counting” bloom filter); the more elements that are added to the set, the larger the probability of false positives.</p><p id="19055649-8dde-4ea4-9fb1-306043d46a34" class="">Usecases</p><ul id="48256796-383a-4678-9008-e0e7d7e931aa" class="bulleted-list"><li style="list-style-type:disc">Cassandra uses Bloom filters to determine whether an SSTable has data for a particular row.</li></ul><ul id="99cec002-1383-49c5-86b8-1759c688ab5f" class="bulleted-list"><li style="list-style-type:disc">An H-Base Bloom Filter is an efficient mechanism to test whether a StoreFile contains a specific row or row-col cell.</li></ul><ul id="7808b7e3-c690-49c2-a956-a6afda416a5f" class="bulleted-list"><li style="list-style-type:disc">A website’s anti-fraud system can use bloom filters to reject banned users effectively.</li></ul><ul id="2a8e9c29-a541-4019-b61f-0edb86bb6233" class="bulleted-list"><li style="list-style-type:disc">The Google Chrome web browser used to use a Bloom filter to identify malicious URLs.</li></ul></div></article></body></html>